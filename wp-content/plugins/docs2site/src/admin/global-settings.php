<?php
/**
 * Global options page.
 */
use \Firebase\JWT\JWT;

$current_user = wp_get_current_user();

// Generate token payload with user credentials.
$token_payload = [
		'site_url' => home_url( '/' ),
		'name'     => $current_user->display_name,
		'email'    => $current_user->user_email
];

// client secret key.
$key = wp_generate_password( 8, true, false );

// TODO: We can later add Connect button to connet with API automatically.
// Retreve saved auth.
$auth_token = get_option( 'docs2site_importer_connect_token', false );

if ( ! $auth_token ) {
	// generate JWT token from the client secret.
	$auth_token = JWT::encode($token_payload, base64_decode(strtr($key, '-_', '+/')), 'HS256');

	// Save token to database.
	update_option( 'docs2site_importer_connect_token', $auth_token );
}

?>
<form action="" class="docs2site-importer-settings">
	<div class="logo">
		<svg xmlns="http://www.w3.org/2000/svg" width="135" height="33.736" viewBox="0 0 135 33.736">
			<g id="Group_5443" data-name="Group 5443" transform="translate(-511 -422.066)">
				<g id="Group_5235" data-name="Group 5235" transform="translate(545.615 433.216)" opacity="0.9" style="isolation: isolate">
					<path id="Path_26484" data-name="Path 26484" d="M634,474.343V472.8l1.487-.31v-9.983L634,462.2v-1.552h5.881a5.835,5.835,0,0,1,5.391,3.246,7.482,7.482,0,0,1,.781,3.481v.254a7.57,7.57,0,0,1-.767,3.458,5.769,5.769,0,0,1-5.359,3.26Zm4.046-1.966h1.75a3.2,3.2,0,0,0,1.995-.621,3.931,3.931,0,0,0,1.256-1.694,6.4,6.4,0,0,0,.438-2.437v-.273a6.423,6.423,0,0,0-.438-2.451,3.838,3.838,0,0,0-1.256-1.675,3.255,3.255,0,0,0-1.995-.607h-1.75Z" transform="translate(-633.996 -460.643)" fill="#0a083b"/>
					<path id="Path_26485" data-name="Path 26485" d="M689.22,483.609a4.763,4.763,0,0,1-2.559-.659,4.352,4.352,0,0,1-1.637-1.83,6.05,6.05,0,0,1-.574-2.7v-.2a6,6,0,0,1,.574-2.681,4.421,4.421,0,0,1,1.637-1.835,5.2,5.2,0,0,1,5.09,0,4.358,4.358,0,0,1,1.632,1.83,6.06,6.06,0,0,1,.57,2.691v.2a6.09,6.09,0,0,1-.57,2.7,4.322,4.322,0,0,1-1.632,1.83A4.709,4.709,0,0,1,689.22,483.609Zm0-1.967a1.851,1.851,0,0,0,1.228-.4,2.39,2.39,0,0,0,.72-1.134,5.469,5.469,0,0,0,.235-1.68v-.2a5.391,5.391,0,0,0-.235-1.665,2.4,2.4,0,0,0-.725-1.134,1.871,1.871,0,0,0-1.242-.409,1.851,1.851,0,0,0-1.237.409,2.418,2.418,0,0,0-.72,1.134,5.4,5.4,0,0,0-.235,1.665v.2a5.464,5.464,0,0,0,.235,1.684,2.369,2.369,0,0,0,.725,1.129A1.9,1.9,0,0,0,689.22,481.642Z" transform="translate(-670.895 -469.711)" fill="#0a083b"/>
					<path id="Path_26486" data-name="Path 26486" d="M730.65,483.609a4.672,4.672,0,0,1-2.507-.654,4.349,4.349,0,0,1-1.632-1.811,5.915,5.915,0,0,1-.574-2.663v-.31a5.832,5.832,0,0,1,.579-2.644,4.458,4.458,0,0,1,1.633-1.821,4.563,4.563,0,0,1,2.484-.663,5.86,5.86,0,0,1,2.329.423,5.246,5.246,0,0,1,1.595,1.016V477.3h-1.938l-.358-1.816a1.812,1.812,0,0,0-.621-.4,2.135,2.135,0,0,0-.8-.151,2.052,2.052,0,0,0-1.284.4,2.446,2.446,0,0,0-.791,1.12,4.894,4.894,0,0,0-.268,1.708v.31a4.75,4.75,0,0,0,.282,1.764,2.277,2.277,0,0,0,.776,1.049,2.025,2.025,0,0,0,2.357-.061,2.015,2.015,0,0,0,.64-1.152h2.193l.028.056a4.6,4.6,0,0,1-.607,1.821,3.2,3.2,0,0,1-1.337,1.218A4.834,4.834,0,0,1,730.65,483.609Z" transform="translate(-701.238 -469.711)" fill="#0a083b"/>
					<path id="Path_26487" data-name="Path 26487" d="M769.5,483.634a9.711,9.711,0,0,1-2.084-.212,9.613,9.613,0,0,1-1.887-.626l-.028-2.785H767.3l.357,1.468a3.833,3.833,0,0,0,1.685.357,2.214,2.214,0,0,0,1.369-.324,1.009,1.009,0,0,0,.4-.814,1.021,1.021,0,0,0-.423-.814,4.142,4.142,0,0,0-1.637-.6,5.74,5.74,0,0,1-2.673-1.162,2.566,2.566,0,0,1-.856-1.99,2.8,2.8,0,0,1,.438-1.534,3.079,3.079,0,0,1,1.312-1.105,5.069,5.069,0,0,1,2.192-.419,8.5,8.5,0,0,1,2.084.235,6.246,6.246,0,0,1,1.566.6l.047,2.691h-1.8l-.292-1.336a2.092,2.092,0,0,0-.64-.306,2.934,2.934,0,0,0-.828-.108,1.892,1.892,0,0,0-1.172.32,1,1,0,0,0-.277,1.327,1.286,1.286,0,0,0,.55.438,5.645,5.645,0,0,0,1.2.381,6.666,6.666,0,0,1,2.8,1.176,2.483,2.483,0,0,1,.861,1.995,2.859,2.859,0,0,1-1.011,2.268A4.584,4.584,0,0,1,769.5,483.634Z" transform="translate(-730.171 -469.736)" fill="#0a083b"/>
				</g>
				<g id="Group_5236" data-name="Group 5236" transform="translate(593.872 433.049)" style="isolation: isolate">
					<path id="Path_26488" data-name="Path 26488" d="M822.637,471.945v1.972H810.9v-1.684l4.46-4.818a15.339,15.339,0,0,0,1.1-1.369,4.641,4.641,0,0,0,.569-1.054,2.821,2.821,0,0,0,.17-.955,2.171,2.171,0,0,0-.494-1.444,1.769,1.769,0,0,0-1.435-.588,1.875,1.875,0,0,0-1.529.64,2.705,2.705,0,0,0-.532,1.778h-2.484l-.019-.056a4.227,4.227,0,0,1,.527-2.211,4,4,0,0,1,1.6-1.562,5.064,5.064,0,0,1,2.475-.574,5.23,5.23,0,0,1,2.381.5,3.68,3.68,0,0,1,1.534,1.392,3.921,3.921,0,0,1,.536,2.065,4.09,4.09,0,0,1-.291,1.529,6.439,6.439,0,0,1-.9,1.519q-.612.791-1.552,1.8l-2.851,3.077.019.047H818" transform="translate(-810.702 -460.02)" fill="#175cff"/>
				</g>
				<g id="Group_5237" data-name="Group 5237" transform="translate(612.433 432.237)" opacity="0.9" style="isolation: isolate">
					<path id="Path_26489" data-name="Path 26489" d="M881.952,474.026a9.941,9.941,0,0,1-2.686-.344,7.838,7.838,0,0,1-2.394-1.162v-3.237h1.976l.3,1.995a3.592,3.592,0,0,0,1.2.574,5.688,5.688,0,0,0,1.6.216,3.526,3.526,0,0,0,1.331-.221,1.787,1.787,0,0,0,.823-.63,1.642,1.642,0,0,0,.282-.955,1.691,1.691,0,0,0-.254-.927,2.274,2.274,0,0,0-.832-.725,7.785,7.785,0,0,0-1.567-.616,13.122,13.122,0,0,1-2.635-1.007,4.2,4.2,0,0,1-1.576-1.36,3.374,3.374,0,0,1-.522-1.9,3.279,3.279,0,0,1,.607-1.953,4.089,4.089,0,0,1,1.684-1.341,6.046,6.046,0,0,1,2.479-.5,8.284,8.284,0,0,1,2.757.386,6.529,6.529,0,0,1,2.042,1.091v3.011h-1.929l-.348-1.891a3.551,3.551,0,0,0-.988-.433,5.031,5.031,0,0,0-1.412-.179,3.237,3.237,0,0,0-1.214.212,1.874,1.874,0,0,0-.828.616,1.576,1.576,0,0,0-.3.969,1.43,1.43,0,0,0,.264.856,2.37,2.37,0,0,0,.884.678,11.523,11.523,0,0,0,1.684.64,8.381,8.381,0,0,1,3.411,1.651,3.449,3.449,0,0,1,1.162,2.7,3.286,3.286,0,0,1-.626,2,4.015,4.015,0,0,1-1.75,1.317A6.83,6.83,0,0,1,881.952,474.026Z" transform="translate(-876.871 -459.149)" fill="#0a083b"/>
					<path id="Path_26490" data-name="Path 26490" d="M919.1,471.678v-1.543l1.364-.282v-6.521l-1.477-.282V461.5h4.036v8.355l1.364.282v1.543Zm1.27-12.411V457h2.653v2.268Z" transform="translate(-907.674 -457)" fill="#0a083b"/>
					<path id="Path_26491" data-name="Path 26491" d="M946.377,477.348a2.822,2.822,0,0,1-2.1-.757,3.315,3.315,0,0,1-.748-2.4V468.8h-1.439v-1.816h1.439v-2.484h2.55v2.484h1.947V468.8h-1.947v5.392a1.258,1.258,0,0,0,.263.894.935.935,0,0,0,.706.273,4.224,4.224,0,0,0,.536-.038c.195-.025.357-.05.49-.075l.245,1.816a8.075,8.075,0,0,1-.936.207A6.151,6.151,0,0,1,946.377,477.348Z" transform="translate(-924.568 -462.481)" fill="#0a083b"/>
					<path id="Path_26492" data-name="Path 26492" d="M974,483.609a4.824,4.824,0,0,1-2.526-.645,4.408,4.408,0,0,1-1.67-1.778,5.512,5.512,0,0,1-.593-2.592v-.386a6.027,6.027,0,0,1,.569-2.667,4.442,4.442,0,0,1,1.595-1.835,4.269,4.269,0,0,1,2.371-.663,4.533,4.533,0,0,1,2.324.551,3.491,3.491,0,0,1,1.421,1.576,5.78,5.78,0,0,1,.48,2.465v1.421h-6.107l-.019.056a3.178,3.178,0,0,0,.329,1.3,2.243,2.243,0,0,0,.819.9,2.369,2.369,0,0,0,1.28.329,4.672,4.672,0,0,0,2.729-.818l.734,1.59a5.2,5.2,0,0,1-1.552.852A6.351,6.351,0,0,1,974,483.609Zm-2.108-6.295h3.67v-.245a3.022,3.022,0,0,0-.188-1.115,1.557,1.557,0,0,0-.579-.739,1.776,1.776,0,0,0-1.012-.264,1.561,1.561,0,0,0-.969.306,2.087,2.087,0,0,0-.639.828,3.962,3.962,0,0,0-.311,1.181Z" transform="translate(-944.406 -468.733)" fill="#0a083b"/>
				</g>
				<g id="Group_9" data-name="Group 9" transform="translate(511 422.066)">
					<path id="Subtraction_1" data-name="Subtraction 1" d="M535.434,455.972H511V432.627L523.1,422.3h12.331v33.673Zm-15.469-14.915v6.5h6.5v-6.5Z" transform="translate(-511 -422.236)" fill="#175cff"/>
					<g id="Group_8" data-name="Group 8" transform="translate(0.009)">
						<path id="Path_26464" data-name="Path 26464" d="M511.035,432.395l12.1-10.329v10.329Z" transform="translate(-511.035 -422.066)" fill="#fff"/>
						<path id="Path_26465" data-name="Path 26465" d="M511.035,432.395l12.1-10.329v10.329Z" transform="translate(-511.035 -422.066)" fill="#175cff" opacity="0.4" style="isolation: isolate"/>
					</g>
				</g>
				<g id="Path_26466" data-name="Path 26466" transform="translate(602.555 441.614)">
					<path id="Path_26493" data-name="Path 26493" d="M843.834,500.526a.806.806,0,0,1-.56-1.385l2.987-2.885-2.886-2.986a.806.806,0,0,1,1.159-1.12l3.446,3.565a.806.806,0,0,1-.019,1.14l-3.566,3.445A.8.8,0,0,1,843.834,500.526Z" transform="translate(-843.028 -491.904)" fill="#175cff"/>
				</g>
			</g>
		</svg>
	</div>
	<table>
		<tr>
			<td>
				<label for="docs2site-auth-token"><?php esc_html_e( 'Authentication Token', 'docs2site' ); ?></label>
				<span class="label-description"><?php esc_html_e( 'Copy the authentication token displayed below and paste it to your Docs2Site application settings to connect this WordPress site.', 'docs2site' ) ?></span>
			</td>
			<td>
				<textarea id="docs2site-auth-token" readonly cols="30" rows="10"><?php echo esc_attr( $auth_token ); ?></textarea>
				<button class="docs2site-authkey-copy" type="button">
					<span>
						<svg xmlns="http://www.w3.org/2000/svg" width="15.572" height="18.167" viewBox="0 0 15.572 18.167">
							<path id="Path_16" data-name="Path 16" d="M632.676,248H622.3a1.226,1.226,0,0,0-1.3,1.3v11.677h1.3V249.3h10.38Zm-7.785,2.595a1.226,1.226,0,0,0-1.3,1.3v12.975c0,.951.346,1.3,1.3,1.3h10.38c.951,0,1.3-.346,1.3-1.3V251.891c0-.951-.346-1.3-1.3-1.3Zm0,14.272h10.38V251.891h-10.38Z" transform="translate(-620.997 -247.997)" fill="#fff" fill-rule="evenodd"/>
						</svg>
					</span><?php esc_html_e( 'Copy', 'docs2site' ); ?> 
				</button>
			</td>
		</tr>
	</table>
</form>
<?php
